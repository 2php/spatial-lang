# Part I: Controlling Peripherals
## Writing to LED registers

In this part, we will write a program that increments the LED register every time we run it. On DE1-SoC, the red LEDs will turn on based on the value stored in the LED register. For example, if the LED register stores 2, only the 2nd-to-the-right LED will turn on to indicate a binary 10. 

Upon startup, DE1SoC loads a bitstream into /dev/fpga that maps a set of peripheral registers to the ARM2FPGA bridge. The ARM2FPGA bridge starts at address 0xff200000, and the register controlling LEDs locates at offset 0x0. Your task is to write 1 to this register whenever the program runs. Take a look at led.c, complete the program by following the comments, and test it by running the following commands on DE1SoC: 
```cplusplus 
make && sudo ./led
```

# Part II: Handling Interrupts

In this part, we will explore how to implement an interrupt handler in Linux. Specifically, we will handle interrupts generated by the four push buttons. To accomplish this, we will create a kernel module, which is a special program that can be inserted into the Linux kernel. 

The ARM processor contains 256 interrupt request (IRQ) lines ranging from IRQ0 to IRQ255. In the default DE1SoC system, the interrupt sender of the pushbutton has been connected to IRQ73. Therefore, our kernel module needs to register an interrupt handler that will listen to IRQ73. 

To register an interrupt handler, we can take a look at the pushbutton_irq_handler.c and complete the program by following the comments.

We can test our implementation by running: 
```cplusplus
make all
insmod pushbutton_irq_handler.ko
```

To confirm that our module is inserted, we can run: 
```cplusplus
lsmod
```

We will observe that the on-board LEDs increment every time we press the pushbutton. 

To stop the kernel module, we can run: 
```cplusplus
rmmod pushbutton_irq_handler
```

If you want to know more about kernel modules in Linux, take a look at https://lwn.net/Kernel/LDD3/

# Board Setup
To transfer files from your local computer to DE1SoC, run: 
```cplusplus
scp -r YOUR_SRC_DIR ee109@ee109-GROUP_NUMBER.stanford.edu:~/YOUR_TARGET_DIR
```
To sign in to your FPGA, run: 
```cplusplus
ssh ee109@ee109-GROUP_NUMBER.stanford.edu
```
